name: Build and Deploy

on: 
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: 
      name: DEV
    env:
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY}}
      AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID}}
      AWS_ENVIRONMENT: DEV

    steps:
     - uses: actions/checkout@v2
     - name: Build & Zip
       run: |
         pwd 
         ls -a 
         #zip -r my-function.zip .
         #ls -a
         

     - name: Configure AWS Credentials
       uses: aws-actions/configure-aws-credentials@v1
       with: 
         aws-access-key-id: ${{ env.AWS_ACCESS_KEY_ID }}
         aws-secret-access-key: ${{ env.AWS_SECRET_ACCESS_KEY}}
         #role-duration-seconds: 2400
         aws-region: us-east-1
         role-skip-session-tagging: true

     - name: Deploy lambda function 
       run: | 
         ls -A
         #aws lambda create-function \
         #--function-name my-function \
         #--runtime nodejs10.x \
         #--zip-file fileb://my-function.zip \
         #--handler my-function.handler \
         #--role arn:aws:iam::123456789012:role/service-role/MyTestFunction-role-tges6bf4
         #aws s3 cp index.zip s3://${{ env.S3_BUCKET }}       
